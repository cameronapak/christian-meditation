---
import Layout from "../../layouts/Layout.astro";
import Logo from "../../components/Logo.astro";
import Footer from "../../components/Footer.astro";
import { getMeditationById } from "../../api/baserow/meditations";
import { getCreatorById } from "../../api/baserow/creators";

const { id } = Astro.params;

if (!id) {
  return Astro.redirect("/");
}

const meditation = await getMeditationById(id);
const creator = await getCreatorById(meditation.Creator[0].id);

if (!meditation) {
  return Astro.redirect("/");
}
---

<Layout
  className="bg-white"
  title={`${meditation.Title} | by ${creator.Name} | Christian Meditation on Soul Rest`}
  description={`${meditation.Title} | by ${creator.Name} | Christian Meditation on Soul Rest`}
>
  <main class="container p-6 outline-none">
    <div class="flex gap-2 sticky top-0 py-2 bg-white z-20">
      <div class="w-full">
        <Logo />
      </div>
      <button
        x-data
        class="btn btn-circle btn-outline border-gray-300 rounded-full btn-sm"
        x-on:click="navigator.clipboard.writeText(window.location.href); alert('Meditation copied to your clipboard. Paste to share!');"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={20}
          height={20}
          viewBox="0 0 24 24"
        >
          <path
            fill="none"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 5v8.5M15 7l-3-3l-3 3m-4 5v5a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-5"
          ></path>
        </svg>
      </button>
    </div>
    <div class="flex flex-col gap-0">
      <div class="text-sm breadcrumbs m-0">
        <ul class="!p-0 !m-0">
          <li><a href="/">Home</a></li>
          <li>{meditation.Title}</li>
        </ul>
      </div>
    </div>
    <iframe
      class="aspect-video w-full rounded-2xl shadow-lg"
      src={"https://www.youtube.com/embed/" + meditation["YouTube Video ID"]}
      title="YouTube video player"
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      allowfullscreen></iframe>

    <Footer />
  </main>
</Layout>
